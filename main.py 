# main.py
"""
Main entry point for the Arduino Data Scraper
"""

from src.scraper import run_scraper
from src.data_cleaner import clean_data
from src.image_downloader import download_device_images
from src.utils import setup_folders
import glob

def main():
    """Main function to run the complete data pipeline"""
    print("Arduino Data Collection Pipeline")
    print("=" * 40)
    
    # Setup folder structure
    setup_folders()
    
    while True:
        print("\nSelect an option:")
        print("1. Run Complete Pipeline (Scrape + Clean + Download Images)")
        print("2. Run Scraper Only")
        print("3. Clean Data Only")
        print("4. Download Images Only")
        print("5. Exit")
        
        choice = input("\nEnter your choice (1-5): ").strip()
        
        if choice == '1':
            # Complete pipeline
            run_scraper()
            clean_data()
            json_files = glob.glob('data/raw/scraped_json/arduino_data_*.json')
            if json_files:
                latest_file = max(json_files, key=lambda x: x)
                download_device_images(latest_file)
        
        elif choice == '2':
            # Scraper only
            run_scraper()
        
        elif choice == '3':
            # Clean data only
            clean_data()
        
        elif choice == '4':
            # Download images only
            json_files = glob.glob('data/raw/scraped_json/arduino_data_*.json')
            if json_files:
                latest_file = max(json_files, key=lambda x: x)
                download_device_images(latest_file)
            else:
                print("No scraped data found. Please run the scraper first.")
        
        elif choice == '5':
            print("Exiting...")
            break
        
        else:
            print("Invalid choice. Please enter 1-5.")

if __name__ == "__main__":
    main()